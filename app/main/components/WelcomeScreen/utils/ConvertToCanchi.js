export const can = [
    'Giáp',
    'Ất',
    'Bính',
    'Đinh',
    'Mậu',
    'Kỷ',
    'Canh',
    'Tân',
    'Nhâm',
    'Quý',
];
export const canEn = [
    'Jia',
    'Yi',
    'Bing',
    'Ding',
    'Wu',
    'Ji',
    'Geng',
    'Xin',
    'Ren',
    'Gui',
];
export const chi = [
    'Tý',
    'Sửu',
    'Dần',
    'Mão',
    'Thìn',
    'Tỵ',
    'Ngọ',
    'Mùi',
    'Thân',
    'Dậu',
    'Tuất',
    'Hợi',
];
export const chiEn = [
    'Zi',
    'Chou',
    'Yin',
    'Mao',
    'Chen',
    'Si',
    'Wu',
    'Wei',
    'Shen',
    'You',
    'Xu',
    'Hai',
];
export const chiofMonth = [
    'Dần',
    'Mão',
    'Thìn',
    'Tỵ',
    'Ngọ',
    'Mùi',
    'Thân',
    'Dậu',
    'Tuất',
    'Hợi',
    'Tý',
    'Sửu',
];
export const hoangdao = {
    '1': ['Tý', 'Sửu', 'Tị', 'Mùi'],
    '2': ['Dần', 'Mão', 'Mùi', 'Dậu'],
    '3': ['Thìn', 'Tị', 'Dậu', 'Hợi'],
    '4': ['Ngọ', 'Mùi', 'Sửu', 'Dậu'],
    '5': ['Thân', 'Dậu', 'Sửu', 'Mão'],
    '6': ['Tuất', 'Hợi', 'Mão', 'Tị'],
    '7': ['Tý', 'Sửu', 'Tị', 'Mùi'],
    '8': ['Dần', 'Mão', 'Mùi', 'Dậu'],
    '9': ['Thìn', 'Tị', 'Dậu', 'Hợi'],
    '10': ['Ngọ', 'Mùi', 'Sửu', 'Dậu'],
    '11': ['Thân', 'Dậu', 'Sửu', 'Mão'],
    '12': ['Tuất', 'Hợi', 'Mão', 'Tị'],
};
export const tietkhi = [
    'Xuân Phân',
    'Thanh minh',
    'Cốc Vũ',
    'Lập Hạ',
    'Tiểu Mãn',
    'Mang Chủng',
    'Hạ Chí',
    'Tiểu Thử',
    'Đại thử',
    'Lập thu',
    'Xử thử',
    'Bạch lộ',
    'Thu phân',
    'Hàn lộ',
    'Sương giáng',
    'Lập đông',
    'Tiểu tuyết',
    'Đại tuyết',
    'Đông chí',
    'Tiểu hàn',
    'Đại hàn',
    'Lập xuân',
    'Vũ Thủy',
    'Kinh trập',
];
var GIO_HD = [
    '110100101100',
    '001101001011',
    '110011010010',
    '101100110100',
    '001011001101',
    '010010110011',
];
const _28starGood = {
    '20':
        'Tạo tác mọi việc đều đặng vinh xương, tấn lợi. Hôn nhân cưới gã sanh con quý. Công danh khoa cử cao thăng, đỗ đạt.',
    '21': 'Cắt may áo màn (sẽ có lộc ăn).',
    '22': 'Sao Đê Đại Hung , không cò việc chi hạp với nó',
    '23':
        'Chủ vượng về tài sản ruộng đất, giàu sang, xây cất, cưới xin, hài hòa vui vẻ',
    '24': 'Tạo tác việc chi cũng không hạp với Hung tú này.',
    '25':
        'Mọi việc đều tốt , tốt nhất là các vụ khởi tạo , chôn cất , cưới gã , xây cất , trổ cửa , đào ao giếng , khai mương rạch.',
    '26':
        'Khởi tạo trăm việc đều tốt, tốt nhất là chôn cất, tu bổ mồ mã, trổ cửa, khai trương, xuất hành, các vụ thủy lợi ( như tháo nước, đào kinh, khai thông mương rảnh...).',
    '27':
        'Khởi tạo trăm việc đều tốt, tốt nhất là xây đắp hay sửa chữa phần mộ, trổ cửa, tháo nước, các vụ thủy lợi, chặt cỏ phá đất, may cắt áo mão, kinh doanh, giao dịch.',
    //sao ngưu
    '0': 'Đi thuyền, cắt may áo mão.',
    '1': 'Kết màn, may áo.',
    '2': 'Hư có nghĩa là hư hoại, không có việc chi hợp với Sao Hư.',
    '3': 'Chôn cất rất tốt, lót giường bình yên.',
    '4':
        'Khởi công trăm việc đều tốt. Tốt nhất là xây cất nhà cửa, cưới gã, chôn cất, trổ cửa, tháo nước, các việc thủy lợi, đi thuyền, chặt cỏ phá đất.',
    '5':
        'Khởi công tạo tác việc chi cũng tốt. Tốt nhất là xây cất nhà, cưới gã, chôn cất, trổ cửa, dựng cửa, tháo nước, các vụ thuỷ lợi, chặt cỏ phá đất.',
    '6': 'Tạo dựng nhà phòng , nhập học , ra đi cầu công danh , cắt áo.',
    '7':
        'Khởi công mọi việc đều tốt . Tốt nhất là dựng cột, cất lầu, làm dàn gác, cưới gã, trổ cửa dựng cửa, tháo nước hay các vụ thủy lợi, cắt áo.',
    '8':
        'Khởi công tạo tác việc chi cũng lợi. Tốt nhất là xây cất, cưới gã, chôn cất, chặt cỏ phá đất, gieo trồng, lấy giống.',
    '9': 'Xây dựng , tạo tác.',
    '10':
        'Khởi công tạo tác việc chi cũng tốt. Tốt nhất là chôn cất, cưới gã, trổ cửa dựng cửa, đào kinh, tháo nước, khai mương, móc giếng, chặt cỏ phá đất.',
    '11': 'Không có sự việc chi hợp với Sao Chủy.',
    '12':
        'Khởi công tạo tác nhiều việc tốt như : xây cất nhà, dựng cửa trổ cửa, nhập học, đi thuyền, làm thủy lợi, tháo nước đào mương.',
    '13':
        'Tạo tác nhiều việc tốt như xây cất, trổ cửa dựng cửa, mở thông đường nước, đào mương móc giếng, nhậm chức, nhập học, đi thuyền.',
    '14': 'Chôn cất, chặt cỏ phá đất, cắt áo.',
    '15': 'Không có việc chi hạp với Sao Liễu.',
    '16': 'Xây dựng phòng mới.',
    '17':
        'Khởi công tạo tác trăm việc tốt, tốt nhất là xây cất nhà, che mái dựng hiên, trổ cửa dựng cửa, cưới gã, chôn cất, làm ruộng, nuôi tằm.',
    '18': 'Cắt áo sẽ đước tiền tài.',
    '19':
        'Khởi công tạo tác mọi việc tốt lành, tốt nhất là xây cất lầu gác, chôn cất, cưới gã. Các việc khác cũng tốt như dựng phòng, cất trại, xuất hành, chặt cỏ phá đất.',
};

const _28starBad = {
    '20':
        'Chôn cất hoạn nạn 3 năm. Sửa chữa hay xây đắp mộ phần ắt có người chết. Sanh con nhằm ngày có Sao Giác khó nuôi, nên lấy tên Sao mà đặt tên cho nó mới an toàn.',
    '21':
        'Chôn cất bị Trùng tang. Cưới gã e phòng không giá lạnh. Tranh đấu kiện tụng lâm bại. Khởi dựng nhà cửa chết con đầu. 10 hoặc 100 ngày sau thì gặp họa.',
    '22':
        'Khởi công xây dựng, chôn cất, cưới gã, xuất hành kỵ nhất là đường thủy, sanh con chẳng phải điềm lành nên làm Âm Đức cho nó.',
    '23': 'Sao Phòng là Đại Kiết Tinh, không kỵ việc chi cả.',
    '24':
        'Khởi công tạo tác việc chi cũng không khỏi hại, thứ nhất là xây cất, cưới gã, chôn cất, đóng giường, lót giường, tranh tụng.',
    '25': 'Đóng giường , lót giường, đi thuyền.',
    '26': 'Đóng giường , lót giường, đi thuyền.',
    '27':
        'Rất kỵ đi thuyền. Con mới sanh đặt tên nó là Đẩu, Giải, Trại hoặc lấy tên Sao của năm hay tháng hiện tại mà đặt tên cho nó dễ nuôi.',
    '0':
        'Khởi công tạo tác việc chi cũng hung hại. Nhất là xây cất nhà, dựng trại, cưới gã, trổ cửa, làm thủy lợi, nuôi tằm, gieo cấy.',
    '1':
        'Khởi công tạo tác trăm việc đều có hại, hung hại nhất là trổ cửa, khơi đường tháo nước, chôn cất, đầu đơn kiện cáo.',
    '2':
        'Khởi công tạo tác trăm việc đều không may, thứ nhất là xây cất nhà cửa, cưới gã, khai trương, trổ cửa, tháo nước, đào kinh rạch.',
    '3':
        'Dựng nhà, trổ cửa, gác đòn đông, tháo nước, đào mương rạch, đi thuyền.',
    '4': 'Sao thất Đại Kiết không có việc chi phải cử.',
    '5': 'Sao Bích toàn kiết, không có việc chi phải kiêng cử.',
    '6':
        'Chôn cất , khai trương , trổ cửa dựng cửa , khai thông đường nước , đào ao móc giếng , thưa kiện , đóng giường lót giường.',
    '7': 'Đóng giường , lót giường, đi đường thủy.',
    '8': 'Đi thuyền.',
    '9':
        'Chôn Cất ( ĐẠI KỴ ), cưới gã, trổ cửa dựng cửa, khai ngòi phóng thủy, khai trương, xuất hành, đóng giường lót giường. Các việc khác cũng không hay.',
    '10': 'Đi thuyền.',
    '11':
        'Khởi công tạo tác việc chi cũng không tốt. KỴ NHẤT là chôn cất và các vụ thuộc về chết chôn như sửa đắp mồ mả, làm sanh phần (làm mồ mã để sẵn).',
    '12': 'Cưới gã, chôn cất, đóng giường lót giường, kết bạn.',
    '13': 'Chôn cất, tu bổ phần mộ, làm sanh phần, đóng thọ đường.',
    '14':
        'Khởi tạo việc chi cũng hại. Hại nhất là xây cất nhà, cưới gã, trổ cửa dựng cửa, tháo nước, đào ao giếng, động đất, xây tường, dựng cột.',
    '15':
        'Khởi công tạo tác việc chi cũng hung hại. Hung hại nhất là chôn cất, xây đắp, trổ cửa dựng cửa, tháo nước, đào ao lũy, làm thủy lợi.',
    '16': 'Chôn cất, cưới gã, mở thông đường nước.',
    '17': 'Sửa hoặc làm thuyền chèo, đẩy thuyền mới xuống nước.',
    '18':
        'Chôn cất, cưới gã, xây cất nhà, đặt táng kê gác, gác đòn dông, trổ cửa gắn cửa, các vụ thủy lợi.',
    '19': 'Đi thuyền.',
};
export const getSuggest = (month, chi, index) => {
    let sugget = '';
    if (typeof index !== 'number') {
        index = 0;
    }
    if (_28starGood[index] != '') {
        sugget += _28starGood[index] + ', ';
    }
    if (sugget == ', ') {
        sugget = 'Không nên làm gì cả';
    } else {
        sugget = sugget.substring(0, sugget.length - 2);
    }
    return sugget;
};

export const getSuggestBad = (month, chi, index) => {
    let sugget = '';
    if (typeof index !== 'number') {
        index = 0;
    }
    sugget += _28starBad[index] + ', ';

    if (sugget == ', ') {
        sugget = 'Không có gì kiêng kỵ';
    } else {
        sugget = sugget.substring(0, sugget.length - 2);
    }
    return sugget;
};
export const calculateCanofMonth = (year, month) => {
    return can[(year * 12 + month + 3) % 10];
};
export const calculateCanofDay = (year, month, date) => {
    const jd = calculateJuliusDay(year, month, date);
    return can[(jd + 9) % 10];
};
export const calculateChiofDay = (year, month, date) => {
    const jd = calculateJuliusDay(year, month, date);
    return chi[(jd + 1) % 12];
};
export const getCanHour = (year, month, date) => {
    const jd = calculateJuliusDay(year, month, date);
    return can[((jd - 1) * 2) % 10];
};
const calculateJuliusDay = (yy, mm, dd) => {
    var a, y, m, jd;
    a = Math.floor((14 - mm) / 12);
    y = yy + 4800 - a;
    m = mm + 12 * a - 3;
    jd =
        dd +
        Math.floor((153 * m + 2) / 5) +
        365 * y +
        Math.floor(y / 4) -
        Math.floor(y / 100) +
        Math.floor(y / 400) -
        32045;
    if (jd < 2299161) {
        jd =
            dd +
            Math.floor((153 * m + 2) / 5) +
            365 * y +
            Math.floor(y / 4) -
            32083;
    }
    return jd;
    // return (
    //   date + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - 32083
    // )
};

var PI = Math.PI;

/* Discard the fractional part of a number, e.g., INT(3.2) = 3 */
export const INT = d => {
    return Math.floor(d);
};

/* Compute the longitude of the sun at any time.
 * Parameter: floating number jdn, the number of days since 1/1/4713 BC noon
 * Algorithm from: "Astronomical Algorithms" by Jean Meeus, 1998
 */
export const SunLongitude = jdn => {
    var T, T2, dr, M, L0, DL, lambda, theta, omega;
    T = (jdn - 2451545.0) / 36525; // Time in Julian centuries from 2000-01-01 12:00:00 GMT
    T2 = T * T;
    dr = PI / 180; // degree to radian
    M = 357.5291 + 35999.0503 * T - 0.0001559 * T2 - 0.00000048 * T * T2; // mean anomaly, degree
    L0 = 280.46645 + 36000.76983 * T + 0.0003032 * T2; // mean longitude, degree
    DL = (1.9146 - 0.004817 * T - 0.000014 * T2) * Math.sin(dr * M);
    DL =
        DL +
        (0.019993 - 0.000101 * T) * Math.sin(dr * 2 * M) +
        0.00029 * Math.sin(dr * 3 * M);
    theta = L0 + DL; // true longitude, degree
    // obtain apparent longitude by correcting for nutation and aberration
    omega = 125.04 - 1934.136 * T;
    lambda = theta - 0.00569 - 0.00478 * Math.sin(omega * dr);
    // Convert to radians
    lambda = lambda * dr;
    lambda = lambda - PI * 2 * INT(lambda / (PI * 2)); // Normalize to (0, 2*PI)
    return lambda;
};

/* Compute the sun segment at start (00:00) of the day with the given integral Julian day number.
 * The time zone if the time difference between local time and UTC: 7.0 for UTC+7:00.
 * The export const returns a number between 0 and 23.
 * From the day after March equinox and the 1st major term after March equinox, 0 is returned.
 * After that, return 1, 2, 3 ...
 */
export const getSolarTerm = (year, month, date, timeZone) => {
    const jd = calculateJuliusDay(year, month, date);
    return INT((SunLongitude(jd + 1 - 0.5 - timeZone / 24.0) / PI) * 12);
};

export const getGioHoangDao = (year, month, date) => {
    const jd = calculateJuliusDay(year, month, date);

    var chiOfDay = (jd + 1) % 12;
    var gioHD = GIO_HD[chiOfDay % 6]; // same values for Ty' (1) and Ngo. (6), for Suu and Mui etc.
    var ret = '';
    var count = 0;

    let array = [];
    for (var i = 0; i < 12; i++) {
        if (gioHD.charAt(i) == '1') {
            ret += chi[i];
            ret +=
                ' (' + ((i * 2 + 23) % 24) + 'h-' + ((i * 2 + 1) % 24) + 'h)';
            if (count++ < 5) {
                array.push(ret);
                ret = '';
            }
            //if (count == 3) ret += '\n';
        }
    }
    return array;
};
export const getGioHacDao = (year, month, date) => {
    const jd = calculateJuliusDay(year, month, date);

    var chiOfDay = (jd + 1) % 12;
    var gioHD = GIO_HD[chiOfDay % 6]; // same values for Ty' (1) and Ngo. (6), for Suu and Mui etc.
    var ret = '';
    var count = 0;
    let array = [];
    for (var i = 0; i < 12; i++) {
        if (gioHD.charAt(i) != '1') {
            ret += chi[i];
            ret +=
                ' (' + ((i * 2 + 23) % 24) + 'h-' + ((i * 2 + 1) % 24) + 'h)';
            if (count++ < 5) {
                array.push(ret);
                ret = '';
            }
            //if (count == 3) ret += '\n';
        }
    }
    console.log(ret);
    return array;
};
export const getLunarMonth11 = (yy, timeZone) => {
    var k, off, nm, sunLong;
    off = jdFromDate(31, 12, yy) - 2415021;
    k = INT(off / 29.530588853);
    nm = getNewMoonDay(k, timeZone);
    sunLong = getSunLongitude(nm, timeZone); // sun longitude at local midnight
    if (sunLong >= 9) {
        nm = getNewMoonDay(k - 1, timeZone);
    }
    return nm;
};

export const jdFromDate = (dd, mm, yy) => {
    var a, y, m, jd;
    a = INT((14 - mm) / 12);
    y = yy + 4800 - a;
    m = mm + 12 * a - 3;
    jd =
        dd +
        INT((153 * m + 2) / 5) +
        365 * y +
        INT(y / 4) -
        INT(y / 100) +
        INT(y / 400) -
        32045;
    if (jd < 2299161) {
        jd = dd + INT((153 * m + 2) / 5) + 365 * y + INT(y / 4) - 32083;
    }
    return jd;
};
export const jdToDate = jd => {
    var a, b, c, d, e, m, day, month, year;
    if (jd > 2299160) {
        // After 5/10/1582, Gregorian calendar
        a = jd + 32044;
        b = INT((4 * a + 3) / 146097);
        c = a - INT((b * 146097) / 4);
    } else {
        b = 0;
        c = jd + 32082;
    }
    d = INT((4 * c + 3) / 1461);
    e = c - INT((1461 * d) / 4);
    m = INT((5 * e + 2) / 153);
    day = e - INT((153 * m + 2) / 5) + 1;
    month = m + 3 - 12 * INT(m / 10);
    year = b * 100 + d - 4800 + INT(m / 10);
    return new Array(day, month, year);
};

export const getLeapMonthOffset = (a11, timeZone) => {
    var k, last, arc, i;
    k = INT((a11 - 2415021.076998695) / 29.530588853 + 0.5);
    last = 0;
    i = 1; // We start with the month following lunar month 11
    arc = getSunLongitude(getNewMoonDay(k + i, timeZone), timeZone);
    do {
        last = arc;
        i++;
        arc = getSunLongitude(getNewMoonDay(k + i, timeZone), timeZone);
    } while (arc != last && i < 14);
    return i - 1;
};

export const getSunLongitude = (jdn, timeZone) => {
    var T, T2, dr, M, L0, DL, L;
    T = (jdn - 2451545.5 - timeZone / 24) / 36525; // Time in Julian centuries from 2000-01-01 12:00:00 GMT
    T2 = T * T;
    dr = PI / 180; // degree to radian
    M = 357.5291 + 35999.0503 * T - 0.0001559 * T2 - 0.00000048 * T * T2; // mean anomaly, degree
    L0 = 280.46645 + 36000.76983 * T + 0.0003032 * T2; // mean longitude, degree
    DL = (1.9146 - 0.004817 * T - 0.000014 * T2) * Math.sin(dr * M);
    DL =
        DL +
        (0.019993 - 0.000101 * T) * Math.sin(dr * 2 * M) +
        0.00029 * Math.sin(dr * 3 * M);
    L = L0 + DL; // true longitude, degree
    L = L * dr;
    L = L - PI * 2 * INT(L / (PI * 2)); // Normalize to (0, 2*PI)
    return INT((L / PI) * 6);
};

export const getNewMoonDay = (k, timeZone) => {
    var T, T2, T3, dr, Jd1, M, Mpr, F, C1, deltat, JdNew;
    T = k / 1236.85; // Time in Julian centuries from 1900 January 0.5
    T2 = T * T;
    T3 = T2 * T;
    dr = PI / 180;
    Jd1 = 2415020.75933 + 29.53058868 * k + 0.0001178 * T2 - 0.000000155 * T3;
    Jd1 = Jd1 + 0.00033 * Math.sin((166.56 + 132.87 * T - 0.009173 * T2) * dr); // Mean new moon
    M = 359.2242 + 29.10535608 * k - 0.0000333 * T2 - 0.00000347 * T3; // Sun's mean anomaly
    Mpr = 306.0253 + 385.81691806 * k + 0.0107306 * T2 + 0.00001236 * T3; // Moon's mean anomaly
    F = 21.2964 + 390.67050646 * k - 0.0016528 * T2 - 0.00000239 * T3; // Moon's argument of latitude
    C1 =
        (0.1734 - 0.000393 * T) * Math.sin(M * dr) +
        0.0021 * Math.sin(2 * dr * M);
    C1 = C1 - 0.4068 * Math.sin(Mpr * dr) + 0.0161 * Math.sin(dr * 2 * Mpr);
    C1 = C1 - 0.0004 * Math.sin(dr * 3 * Mpr);
    C1 = C1 + 0.0104 * Math.sin(dr * 2 * F) - 0.0051 * Math.sin(dr * (M + Mpr));
    C1 =
        C1 -
        0.0074 * Math.sin(dr * (M - Mpr)) +
        0.0004 * Math.sin(dr * (2 * F + M));
    C1 =
        C1 -
        0.0004 * Math.sin(dr * (2 * F - M)) -
        0.0006 * Math.sin(dr * (2 * F + Mpr));
    C1 =
        C1 +
        0.001 * Math.sin(dr * (2 * F - Mpr)) +
        0.0005 * Math.sin(dr * (2 * Mpr + M));
    if (T < -11) {
        deltat =
            0.001 +
            0.000839 * T +
            0.0002261 * T2 -
            0.00000845 * T3 -
            0.000000081 * T * T3;
    } else {
        deltat = -0.000278 + 0.000265 * T + 0.000262 * T2;
    }
    JdNew = Jd1 + C1 - deltat;
    return INT(JdNew + 0.5 + timeZone / 24);
};

export const convertLunar2Solar = (
    lunarDay,
    lunarMonth,
    lunarYear,
    lunarLeap,
    timeZone,
) => {
    var k, a11, b11, off, leapOff, leapMonth, monthStart;
    if (lunarMonth < 11) {
        a11 = getLunarMonth11(lunarYear - 1, timeZone);
        b11 = getLunarMonth11(lunarYear, timeZone);
    } else {
        a11 = getLunarMonth11(lunarYear, timeZone);
        b11 = getLunarMonth11(lunarYear + 1, timeZone);
    }
    off = lunarMonth - 11;
    if (off < 0) {
        off += 12;
    }
    if (b11 - a11 > 365) {
        leapOff = getLeapMonthOffset(a11, timeZone);
        leapMonth = leapOff - 2;
        if (leapMonth < 0) {
            leapMonth += 12;
        }
        if (lunarLeap != 0 && lunarMonth != leapMonth) {
            return new Array(0, 0, 0);
        } else if (lunarLeap != 0 || off >= leapOff) {
            off += 1;
        }
    }
    k = INT(0.5 + (a11 - 2415021.076998695) / 29.530588853);
    monthStart = getNewMoonDay(k + off, timeZone);
    return jdToDate(monthStart + lunarDay - 1);
};
export const convertSolar2Lunar = (dd, mm, yy, timeZone) => {
    var k,
        dayNumber,
        monthStart,
        a11,
        b11,
        lunarDay,
        lunarMonth,
        lunarYear,
        lunarLeap;
    dayNumber = jdFromDate(dd, mm, yy);
    k = INT((dayNumber - 2415021.076998695) / 29.530588853);
    monthStart = getNewMoonDay(k + 1, timeZone);
    if (monthStart > dayNumber) {
        monthStart = getNewMoonDay(k, timeZone);
    }
    a11 = getLunarMonth11(yy, timeZone);
    b11 = a11;
    if (a11 >= monthStart) {
        lunarYear = yy;
        a11 = getLunarMonth11(yy - 1, timeZone);
    } else {
        lunarYear = yy + 1;
        b11 = getLunarMonth11(yy + 1, timeZone);
    }
    lunarDay = dayNumber - monthStart + 1;
    const diff = INT((monthStart - a11) / 29);
    lunarLeap = 0;
    lunarMonth = diff + 11;
    if (b11 - a11 > 365) {
        const leapMonthDiff = getLeapMonthOffset(a11, timeZone);
        if (diff >= leapMonthDiff) {
            lunarMonth = diff + 10;
            if (diff == leapMonthDiff) {
                lunarLeap = 1;
            }
        }
    }
    if (lunarMonth > 12) {
        lunarMonth = lunarMonth - 12;
    }
    if (lunarMonth >= 11 && diff < 4) {
        lunarYear -= 1;
    }
    return new Array(lunarDay, lunarMonth, lunarYear);
};
